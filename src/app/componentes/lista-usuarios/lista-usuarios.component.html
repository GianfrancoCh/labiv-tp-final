<div *ngIf="isAdmin; else noAccess">
  <h2>Gestión de Usuarios</h2>

  <button class="btn-descargar-excel" (click)="exportarUsuariosExcel()">Exportar Usuarios a Excel</button>
  <!-- Tabla de Usuarios -->
  <table class="user-table">
    <thead>
      <tr>
        <th>Imagen</th> <!-- Nueva columna -->
        <th>Nombre</th>
        <th>Apellido</th>
        <th>Email</th>
        <th>Tipo de Usuario</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody *ngFor="let usuario of usuarios">
      <!-- Iteración de usuarios -->
      <tr>
        <td>
          <img [src]="usuario.imgUrl1 || 'ruta-a-imagen-por-defecto.jpg'" alt="Imagen de {{ usuario.nombre }}" class="user-img">
        </td>
        <td>{{ usuario.nombre }}</td>
        <td>{{ usuario.apellido }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.tipoUsuario }}</td>
        <td>
          <button *ngIf="usuario.tipoUsuario === 'especialista' && !usuario.aprobado" (click)="habilitarEspecialista(usuario)">
            Habilitar
          </button>
          <button *ngIf="usuario.tipoUsuario === 'especialista' && usuario.aprobado" (click)="inhabilitarEspecialista(usuario)">
            Inhabilitar
          </button>
          <button *ngIf="usuario.tipoUsuario === 'paciente'" (click)="mostrarHistoriaClinica(usuario)">
            {{ pacienteSeleccionado?.id === usuario.id ? 'Ocultar' : 'Ver' }} Historia Clínica
          </button>
        </td>
      </tr>
      <!-- Fila adicional para mostrar la historia clínica -->
      <tr *ngIf="pacienteSeleccionado?.id === usuario.id">
        <td colspan="6">
          <app-historia-clinica *ngIf="pacienteSeleccionado" [pacienteId]="pacienteSeleccionado.id" [isAdmin]="true"></app-historia-clinica>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Formulario para Crear Usuarios -->
  <div class="register-container">
    <form [formGroup]="registroForm" (ngSubmit)="crearUsuario()">
      <h2>Crear Nuevo Usuario</h2>
  
      <label for="tipoUsuario">Tipo de usuario</label>
      <div class="tipo-usuario-buttons">
        <button type="button" (click)="setTipoUsuario('paciente')" [class.selected]="tipoUsuario === 'paciente'">
          Paciente
        </button>
        <button type="button" (click)="setTipoUsuario('especialista')" [class.selected]="tipoUsuario === 'especialista'">
          Especialista
        </button>
        <button type="button" (click)="setTipoUsuario('administrador')" [class.selected]="tipoUsuario === 'administrador'">
          Administrador
        </button>
      </div>
  
      <!-- Campos comunes -->
      <label for="nombre">Nombre:</label>
      <input type="text" formControlName="nombre" id="nombre" required>
      <div *ngIf="registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched" class="error">
        <small *ngIf="registroForm.get('nombre')?.errors?.['required']">El nombre es obligatorio.</small>
        <small *ngIf="registroForm.get('nombre')?.errors?.['minlength']">Debe tener al menos 2 caracteres.</small>
      </div>
  
      <!-- Resto del formulario -->
      <!-- Aquí puedes mantener el resto del código de formulario -->
    </form>
  </div>
</div>

<ng-template #noAccess>
  <p>No tienes permiso para acceder a esta sección.</p>
</ng-template>